<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>La Timeline Des Lettres</title>
<link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #faf5eb;      /* crème chaud */
    --bar-bg: #f0e9dd;  /* beige doux */
    --bar-accent-a: #ffdfba;
    --bar-accent-b: #5e441b;
  }

  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background: var(--bg);
    position: relative;
    overflow-x: hidden;
    font-family: 'Kalam', sans-serif;
    color:#222;
  }

/* Effet grain subtil */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background-image: url("https://img.freepik.com/psd-premium/fond-texture-grunge-png-transparentopacite-utilisation-du-mode-ecran-pour-superposition_216166-1700.jpg");
  mix-blend-mode: multiply;
  opacity: 0.15; /* ajuste l’intensité du grain */
}

  .timeline-container {
    position: relative;
    width: 80%;
    max-width: 900px;
    height: 100px;
  }

  /* Barre de progression */
  .progress-bar-container {
    width: 100%;
    height: 40px;
    background-color: #fcf0e195;
    border-radius: 20px;
    border: 1px dotted #5e441b;
    overflow: hidden;
    position: relative;
    margin-top: 20px;
    z-index: 0;
  }

  .progress-bar-fill {
    height: 100%;
    width: 25%; /* valeur d'exemple, ajustable via JS */
    background: linear-gradient(90deg, #ffdfba, #5e441b);
    transition: width 1s ease;
  }

  /* Mois */
  .month-label {
  position: absolute;
  top: -30px;
  text-align: center;
  font-size: 13px;
  color: #333;
  
  /* AJOUT IMPORTANT : Décale l'élément de 50% de sa propre largeur vers la gauche */
  transform: translateX(-50%); 
}

  /*.month-label::after {
    content: '';
    position: absolute;
    top: 14px;
    left: 50%;
    width: 1px;
    height: 16px;
    background: #888;
    transform: translateX(-50%);
  } */

  /* Enveloppe */
  .envelope {
    position: absolute;
    top: -55px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
  }

  /* Animation des SVG autour */
  /* Par défaut, toutes les animations sont masquées */
.month-animation {
  position: absolute;
  top: 20px;
  left: -40%;
  width: 0; /* L'élément a une largeur de 0, mais la transformation est toujours utile */
  height: 0;
  overflow: visible; 
  opacity: 0;
  transition: opacity 0.5s ease;

  /* AJOUT IMPORTANT : Centre le conteneur sur le point de référence (left: 50%) */
  transform: translateX(-50%); 
}

/* Règle pour afficher l'animation du mois en cours */
.month-animation.active-month {
  opacity: 1;
  z-index: 15;
}

  .month-animation svg {
    position: absolute;
    width: 20px;
    height: 20px;
    transform-origin: center;
    opacity: 0.8;
    z-index: 15;
  }

  /* Animations par type */
  @keyframes snow {
    0% { transform: translate(0,-20px) rotate(0deg); opacity:0; }
    50% { opacity:1; }
    100% { transform: translate(var(--x), var(--y)) rotate(360deg); opacity:0; }
  }

  @keyframes petals {
    0% { transform: translate(0,0) rotate(0deg); opacity:0; }
    50% { opacity:1; }
    100% { transform: translate(var(--x), var(--y)) rotate(360deg); opacity:0; }
  }

  @keyframes hearts {
    0% { transform: translate(0,0) scale(0); opacity:0; }
    50% { opacity:1; scale (1); }
    100% { transform: translate(var(--x), var(--y)) scale(1) ; opacity:0; }
  }

  @keyframes waves {
    0% { transform: translate(0,0) rotate(0deg); opacity:1; }
    50% { transform: translate(var(--x), var(--y)) rotate(15deg); }
    100% { transform: translate(0,0) rotate(0deg); opacity:1; }
  }

  @keyframes leaves {
    0% { transform: translate(0,0) rotate(0deg); opacity:0; }
    50% { opacity:1; }
    100% { transform: translate(var(--x), var(--y)) rotate(360deg); opacity:0; }
  }

  @keyframes stars {
    0% { transform: translate(0,0) scale(0.5); opacity:0; }
    50% { opacity:1; scale(1); }
    100% { transform: translate(var(--x), var(--y)) scale(0.5); opacity:0; }
  }

  @keyframes sunbeams {
    0% { transform: rotate(0deg) scale(0.8); }
    50% { transform: rotate(180deg) scale(1); }
    100% { transform: rotate(360deg) scale(0.8); }
  }

  @keyframes ghosts {
    0% { transform: translate(0,0); opacity:0; }
    50% { opacity:1; }
    100% { transform: translate(var(--x), var(--y)); opacity:0; }
  }

/* NOUVEAU CSS pour les traits de mois dans la barre */
.progress-bar-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* S'assurer qu'il est au-dessus du background, mais sous le fill */
    opacity: 0.2; /* Rendre les traits moins dominants */
    pointer-events: none; /* Ignorer les événements de souris */

    /* Dessiner 12 traits espacés de 8.333% (100/12) */
    background: repeating-linear-gradient(
        to right,
        #ffdfba,            /* Couleur du trait */
        #ffdfba 1px,        /* Épaisseur du trait (1px) */
        transparent 1px,
        transparent 8.333%  /* Espace transparent entre les traits */
    );
    /* Décalage: le premier trait doit être invisible car il est à 0% (début de la barre) */
    /* Cependant, pour simplifier, on laisse le premier trait à 0%, il sera masqué par le bord */
}

/* On s'assure que le fill de la barre est au-dessus des traits (z-index plus élevé) */
.progress-bar-fill {
    z-index: 2; /* Doit être au-dessus du ::before */
    height: 100%;
    width: 25%; /* valeur d'exemple, ajustable via JS */
    background: linear-gradient(90deg, #ffdfba, #5e441b);
    transition: width 1s ease;
}

</style>
</head>
<body>

<div class="timeline-container">
  <div class="progress-bar-container">
    <div class="progress-bar-fill"></div>
  </div>

  <!-- Mois avec enveloppe et animation -->
  <div class="month-label" style="left:4.166%">Janvier
    <div class="month-animation" data-month="january"></div>
  </div>
  <div class="month-label" style="left:12.5%">Février
    <div class="month-animation" data-month="february"></div>
  </div>
  <div class="month-label" style="left:20.833%">Mars
    <div class="month-animation" data-month="march"></div>
  </div>
  <div class="month-label" style="left:29.166%">Avril
    <div class="month-animation" data-month="april"></div>
  </div>
  <div class="month-label" style="left:37.5%">Mai
    <div class="month-animation" data-month="may"></div>
  </div>
  <div class="month-label" style="left:45.833%">Juin
    <div class="month-animation" data-month="june"></div>
  </div>
  <div class="month-label" style="left:54.166%">Juillet
    <div class="month-animation" data-month="july"></div>
  </div>
  <div class="month-label" style="left:62.5%">Août
    <div class="month-animation" data-month="august"></div>
  </div>
  <div class="month-label" style="left:70.833%">Septembre
    <div class="month-animation" data-month="september"></div>
  </div>
  <div class="month-label" style="left:79.166%">Octobre
    <div class="month-animation" data-month="october"></div>
  </div>
  <div class="month-label" style="left:87.5%">Novembre
    <div class="month-animation" data-month="november"></div>
  </div>
  <div class="month-label" style="left:95.833%">Décembre
    <div class="month-animation" data-month="december"></div>
  </div>
</div>

<script>
const MONTH_EFFECTS = {
  january: { svg: 'assets/months/january.svg', copies: 5, animation: 'snow', color: '#B3E5FC' }, // Bleu ciel },
  february:{ svg: 'assets/months/february.svg', copies: 4, animation: 'hearts', color: '#eb81d9' }, // Rose },
  march:   { svg: 'assets/months/march.svg', copies: 3, animation: 'petals', color: '#d45776' }, // Rouge pâle },
  april:   { svg: 'assets/months/april.svg', copies: 3, animation: 'rain', color: '#1f4094' }, // Bleu foncé },
  may:     { svg: 'assets/months/may.svg', copies: 4, animation: 'petals', color: '#41a321' }, // Vert },
  june:    { svg: 'assets/months/june.svg', copies: 2, animation: 'petals', color: '#99e8df' }, // Turquoise },
  july:    { svg: 'assets/months/july.svg', copies: 1, animation: 'sunbeams', color: '#ffe417' }, // Jaune },
  august:  { svg: 'assets/months/august.svg', copies: 1, animation: 'waves', color: '#0069fc' }, // Bleu Océan },
  september:{svg: 'assets/months/september.svg', copies: 3, animation: 'leaves', color: '#b86637' }, // Orange },
  october: { svg: 'assets/months/october.svg', copies: 3, animation: 'ghosts', color: '#9c9c9c' }, // Gris },
  november:{ svg: 'assets/months/november.svg', copies: 3, animation: 'leaves', color: '#c4b391' }, // Orange grisé },
  december:{ svg: 'assets/months/december.svg', copies: 10, animation: 'stars', color: '#f2bf50' }, // Doré }
};

// Fonction pour charger un SVG, l’injecter inline, et appliquer une couleur
async function loadSVG(url, color = 'currentColor') {
  const response = await fetch(url);
  const text = await response.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, "image/svg+xml");
  const svg = doc.querySelector('svg');
  
  if (!svg) return null;

  svg.setAttribute('width', '20px');
  svg.setAttribute('height', '20px');
  
  // --- NOUVEAU : Application et Forçage de la couleur ---
  const graphicElements = svg.querySelectorAll('path, circle, rect, polygon, polyline');
  
  graphicElements.forEach(el => {
    // 1. SUPPRIMER les attributs de couleur existants pour éviter les conflits de priorité
    //    Ceci est la clé pour forcer le changement.
    el.removeAttribute('fill');
    el.removeAttribute('stroke');
    
    // 2. Appliquer la nouvelle couleur via style.fill (ou style.stroke si nécessaire)
    //    Nous définissons la couleur ici.

    // Si l'élément est destiné à être rempli, appliquez la couleur 'fill'
    if (el.tagName !== 'polyline' && el.tagName !== 'line') {
       el.style.fill = color;
    } 
    
    // Si l'élément est destiné à avoir une bordure (stroke), appliquez la couleur 'stroke'
    el.style.stroke = color; 
    
    // Assurez-vous que l'opacité est complète si le SVG l'a baissée
    el.style.opacity = 1;
  });
  
  // Si le SVG est simple et n'a pas d'éléments internes, on fixe la couleur sur le SVG lui-même:
  if (graphicElements.length === 0) {
      svg.style.color = color; 
  }
  // ---------------------------------------------
  
  return svg;
}

// Générer animations pour chaque mois
Object.keys(MONTH_EFFECTS).forEach(async month => {
  const { svg: url, copies, animation, color } = MONTH_EFFECTS[month]; // Assurez-vous de déstructurer `color`
  const container = document.querySelector(`.month-animation[data-month="${month}"]`);
  if (!container) return;
  
  // Passez la couleur au loadSVG
  const svgTemplate = await loadSVG(url, color); 
  
  if (!svgTemplate) return; // Sécurité si le SVG n'a pas pu être chargé
  
  for (let i = 0; i < copies; i++) {
    const clone = svgTemplate.cloneNode(true);
    clone.style.setProperty('--x', (Math.random()*40 - 20)+'px');
    clone.style.setProperty('--y', (Math.random()*40 - 20)+'px');
    clone.style.animation = `${animation} ${4 + Math.random()*2}s linear infinite`;
    container.appendChild(clone);
  }
});

// Fonction pour mettre à jour la barre de progression
// Les positions des 1ers de chaque mois (en % de la barre)
const MONTH_POSITIONS = [
    0,          // Janvier (Mois 0)
    8.333,      // Février (Mois 1)
    16.666,     // Mars (Mois 2)
    25,         // Avril (Mois 3)
    33.333,     // Mai (Mois 4)
    41.666,     // Juin (Mois 5)
    50,         // Juillet (Mois 6)
    58.333,     // Août (Mois 7)
    66.666,     // Septembre (Mois 8)
    75,         // Octobre (Mois 9)
    83.333,     // Novembre (Mois 10)
    91.666      // Décembre (Mois 11)
];

// Tableau des noms de mois pour trouver l'élément HTML
const MONTH_NAMES = [
    'january', 'february', 'march', 'april', 'may', 'june',
    'july', 'august', 'september', 'october', 'november', 'december'
];


function updateProgressBar() {
    // 1. Déterminer le mois actuel
    const now = new Date();
    const currentMonthIndex = now.getMonth(); // 0 pour Janvier
    const currentMonthName = MONTH_NAMES[currentMonthIndex]; // 'january'

    // --- Gestion de la position de l'Enveloppe (1er du mois) ---
    const envelopePositionPercentage = MONTH_POSITIONS[currentMonthIndex];
    
    const timelineContainer = document.querySelector('.timeline-container');
    let cursor = document.getElementById('progress-cursor');

    if (timelineContainer) {
        // ... (Le code pour créer et positionner le curseur reste le même) ...
        if (!cursor) {
            cursor = document.createElement('div');
            cursor.id = 'progress-cursor';
            cursor.style.cssText = `
                position: absolute;
                top: -5px;
                height: 50px;
                width: 20px;
                font-size: 24px;
                text-align: center;
                transition: left 0.5s ease;
                pointer-events: none;
                z-index: 10; 
            `;
            cursor.innerHTML = '✉️';
            timelineContainer.appendChild(cursor);
        }
        cursor.style.left = `calc(${envelopePositionPercentage}% - 10px)`;
        cursor.style.display = 'block';
    }

    // --- Gestion de l'Animation du Mois ---
    
    // Désactiver toutes les animations
    document.querySelectorAll('.month-animation').forEach(el => {
        el.classList.remove('active-month');
    });

    // Activer l'animation du mois en cours
    const activeAnimationContainer = document.querySelector(`.month-animation[data-month="${currentMonthName}"]`);
    if (activeAnimationContainer) {
        activeAnimationContainer.classList.add('active-month');
    }


    // --- Mise à jour de la barre de progression (Remplissage) ---
    
    const currentYear = now.getFullYear();
    const startOfYear = new Date(currentYear, 0, 1);
    const endOfYear = new Date(currentYear + 1, 0, 1);
    const totalTime = endOfYear.getTime() - startOfYear.getTime();
    const elapsedTime = now.getTime() - startOfYear.getTime();
    let percentage = (elapsedTime / totalTime) * 100;

    const progressBarFill = document.querySelector('.progress-bar-fill');
    if (progressBarFill) {
        progressBarFill.style.width = `${percentage.toFixed(2)}%`;
    }
}

// Assurez-vous d'appeler updateProgressBar après que les animations SVG aient été créées
// (c'est-à-dire après le Object.keys(MONTH_EFFECTS).forEach(async month => { ... }); )
// Si vous gardez le code d'origine, le `updateProgressBar()` à la fin du script est suffisant.
updateProgressBar();

</script>

</body>
</html>