<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Timeline - SVG months inline + animations</title>
<style>
  :root{
    --bg: #fef6f0;
    --bar-bg: #e8f5e9;
    --bar-accent-a: #ffcf98;
    --bar-accent-b: #1b5e20;
  }

  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--bg);
    font-family: Inter, "Helvetica Neue", Arial, sans-serif;
    color:#222;
  }

  .stage{
    width:90%;
    max-width:900px;
    padding:28px;
    box-sizing:border-box;
  }

  .controls{
    display:flex;
    gap:12px;
    justify-content:flex-end;
    margin-bottom:10px;
  }

  .control-note{ font-size:13px; color:#666; margin-right:auto; align-self:center;}

  select, button { padding:6px 8px; border-radius:6px; border:1px solid #ccc; background:white; }

  /* timeline wrapper */
  .timeline {
    position:relative;
    width:100%;
    height:140px; /* espace pour icônes/enveloppe */
    display:block;
    box-sizing:border-box;
  }

  /* centered progress bar container */
  .progress-bar-wrapper{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    width:420px; /* taille fixe de la barre, changeable */
    max-width:80%;
    height:28px;
    top:58px;
  }

  .progress-bar-container{
    position:relative;
    width:100%;
    height:100%;
    background:var(--bar-bg);
    border-radius:999px;
    border:1px solid rgba(0,0,0,0.06);
    overflow:hidden;
  }

  .progress-bar-fill{
    position:absolute;
    left:0; top:0; bottom:0;
    width:0%;
    border-radius:999px;
    background: linear-gradient(90deg, var(--bar-accent-a), var(--bar-accent-b));
    transition: width 1.2s ease;
  }

  /* points for months - absolute relative to timeline (not the bar wrapper) */
  .month-label{
    position:absolute;
    top:28px; /* label sits above the bar wrapper baseline */
    transform:translate(-50%, -100%);
    font-size:13px;
    color:#333;
    text-align:center;
    pointer-events:none;
    user-select:none;
    width:60px;
  }

  .month-label::after{
    content:'';
    display:block;
    margin:4px auto 0;
    width:2px; height:12px;
    background:#333;
    border-radius:1px;
  }

  /* wrapper for inline SVG icon above the month name */
  .month-svg-wrapper{
    position:absolute;
    top:6px; /* above month label baseline */
    transform:translateX(-50%);
    width:32px;
    height:32px;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:6;
    pointer-events:none;
  }

  .month-svg-wrapper svg{
    width:28px; height:28px;
    display:block;
    overflow:visible;
    vector-effect: non-scaling-stroke;
  }

  /* envelope that appears for current month */
  .envelope {
    position:absolute;
    top:-8px;
    transform:translateX(-50%) translateY(-6px);
    font-size:28px;
    z-index:7;
    opacity:0;
    transition:opacity .25s ease, transform .35s ease;
    pointer-events:none;
  }
  .envelope.show{
    opacity:1;
    transform:translateX(-50%) translateY(-16px);
    animation:envBounce .9s ease;
  }
  @keyframes envBounce{
    0%{ transform:translateX(-50%) translateY(-6px) scale(.95); }
    50%{ transform:translateX(-50%) translateY(-22px) scale(1.05); }
    100%{ transform:translateX(-50%) translateY(-16px) scale(1); }
  }

  /* generic animation classes for inline svgs */
  .float-slow { animation: floatSlow 3.5s ease-in-out infinite; transform-origin:center; }
  .pulse-soft { animation: pulseSoft 2.6s ease-in-out infinite; transform-origin:center; }
  .spin-slow { animation: spinSlow 6s linear infinite; transform-origin:center; }

  @keyframes floatSlow {
    0% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0); }
  }
  @keyframes pulseSoft {
    0% { transform: scale(1); filter:brightness(1); }
    50% { transform: scale(1.08); filter:brightness(1.12); }
    100% { transform: scale(1); filter:brightness(1); }
  }
  @keyframes spinSlow {
    0%{ transform: rotate(0deg); }
    100%{ transform: rotate(360deg); }
  }

  /* month-specific micro-animations for decorative items (petals, stars, waves...) */
  .dec-star { position:absolute; width:8px; height:8px; z-index:5; pointer-events:none;
              clip-path: polygon(50% 0,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
              background:gold; opacity:0; animation:decFall 1.8s linear infinite; }
  @keyframes decFall { 0%{ transform:translateY(0) rotate(0); opacity:1} 100%{ transform:translateY(48px) rotate(360deg); opacity:0} }

  .mar-petal { position:absolute; width:8px; height:8px; border-radius:50%; background:#ff69b4; z-index:5; opacity:0; animation:petalFall 2.4s linear infinite; }
  @keyframes petalFall { 0%{ transform:translateY(0) rotate(0) scale(.9); opacity:1} 100%{ transform:translateY(60px) rotate(60deg) scale(.8); opacity:0 } }

  .janflake { position:absolute; width:8px; height:8px; background:#cfeeff; border-radius:2px; z-index:5; opacity:0; animation:flakeFall 2.8s linear infinite; }
  @keyframes flakeFall { 0%{ transform:translateY(0) rotate(0); opacity:1 } 100%{ transform:translateY(70px) rotate(180deg); opacity:0 } }

  .aug-wave { position:absolute; width:6px; height:20px; border-radius:3px; background:#7fd3ff; opacity:.8; transform-origin:center; animation:wavePulse 1.4s ease-in-out infinite;}
  @keyframes wavePulse { 0%{ transform: translateY(0) scaleY(.8) } 50%{ transform: translateY(-6px) scaleY(1.1) } 100%{ transform: translateY(0) scaleY(.8) } }

  /* small helpers */
  .hidden{ display:none; }
  .month-svg-wrapper.active svg { filter: drop-shadow(0 6px 8px rgba(0,0,0,0.08)); }

  /* responsive */
  @media (max-width:520px){
    .progress-bar-wrapper{ width:320px; }
    .month-label { font-size:12px; width:48px; }
  }

</style>
</head>
<body>
 <div class="stage">
    <div class="controls">
      <div class="control-note">Test: forcer un mois →</div>
      <select id="testMonth">
        <option value="">(mois réel)</option>
        <option value="0">Janvier</option>
        <option value="1">Février</option>
        <option value="2">Mars</option>
        <option value="3">Avril</option>
        <option value="4">Mai</option>
        <option value="5">Juin</option>
        <option value="6">Juillet</option>
        <option value="7">Août</option>
        <option value="8">Septembre</option>
        <option value="9">Octobre</option>
        <option value="10">Novembre</option>
        <option value="11">Décembre</option>
      </select>
      <button id="resetTest">Réinitialiser</button>
    </div>

    <div class="timeline" id="timeline">
      <div class="progress-bar-wrapper">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
      </div>

      <!-- month labels (positioned relative to timeline width, using left%) -->
      <!-- we'll also insert inline svgs into .month-svg-wrapper elements created by JS -->
      <div class="month-label" style="left:0%;">Jan</div>
      <div class="month-label" style="left:8.3%;">Fév</div>
      <div class="month-label" style="left:16.6%;">Mar</div>
      <div class="month-label" style="left:25%;">Avr</div>
      <div class="month-label" style="left:33.3%;">Mai</div>
      <div class="month-label" style="left:41.6%;">Juin</div>
      <div class="month-label" style="left:50%;">Juil</div>
      <div class="month-label" style="left:58.3%;">Août</div>
      <div class="month-label" style="left:66.6%;">Sep</div>
      <div class="month-label" style="left:75%;">Oct</div>
      <div class="month-label" style="left:83.3%;">Nov</div>
      <div class="month-label" style="left:91.6%;">Déc</div>

      <!-- placeholder for icons will be inserted here by JS -->
      <!-- envelope element -->
      <div class="envelope" id="envelope">✉️</div>
    </div>
  </div>

<script>
/*
  Behavior:
  - Fetch assets/months/<monthname>.svg for each month name (lowercase)
  - Insert inline SVG into a wrapper placed at left: monthPercentages[i]%
  - Recolor each SVG's paths to a chosen month color (by setting style.fill)
  - Add an animation class for the active/current month
  - Add small decorative particles (stars, petals, flakes, waves) for certain months
*/

// month filenames must match what you confirmed
const monthFiles = [
  'january.svg','february.svg','march.svg','april.svg',
  'may.svg','june.svg','july.svg','august.svg',
  'september.svg','october.svg','november.svg','december.svg'
];

// left positions (approx) along the timeline width
const monthPercentages = [0,8.3,16.6,25,33.3,41.6,50,58.3,66.6,75,83.3,91.6];

// color palette per month (you can change)
const monthColors = [
  '#8ccff7', // Jan - icy blue
  '#ff9fb1', // Feb - heart pink
  '#ff6fa3', // Mar - petal pink
  '#9ad0f5', // Apr - watering / rain blue
  '#9be7a8', // May - fresh green
  '#ffd479', // Jun - warm light
  '#ffd166', // Jul - sunny yellow
  '#7fd3ff', // Aug - sea blue
  '#c9a16b', // Sep - warm leaf
  '#b5a3ff', // Oct - spooky purple
  '#f6d6a7', // Nov - candle warm
  '#ffeaa7'  // Dec - star gold-ish
];

// utilities
function fetchText(path){ return fetch(path).then(r => { if(!r.ok) throw new Error('SVG fetch failed: '+path); return r.text() }); }

// convert a blob of svg text into a DOM node safely
function svgTextToElement(svgText){
  const parser = new DOMParser();
  const doc = parser.parseFromString(svgText, 'image/svg+xml');
  const svg = doc.documentElement;
  // remove width/height attributes to allow CSS sizing, keep viewBox
  svg.removeAttribute('width');
  svg.removeAttribute('height');
  return svg;
}

// recolor inline svg: set fill on paths/shapes; but keep strokes if present
function recolorSvg(svgEl, color){
  // set currentColor approach: set svgEl.style.color and set shapes to use currentColor if possible
  svgEl.style.color = color;
  // For each element with fill attribute, overwrite with color
  const fillables = svgEl.querySelectorAll('[fill]');
  fillables.forEach(el => {
    // skip if fill is 'none'
    if(el.getAttribute('fill') && el.getAttribute('fill').toLowerCase() !== 'none'){
      el.setAttribute('fill', color);
    }
  });
  // also update inline styles
  const styled = svgEl.querySelectorAll('[style]');
  styled.forEach(el => {
    // if style contains fill:, replace it
    const st = el.getAttribute('style');
    if(st && /fill\s*:/.test(st)){
      const newst = st.replace(/fill\s*:\s*[^;]+;?/, `fill:${color};`);
      el.setAttribute('style', newst);
    }
  });
  // set stroke if present and black -> tint slightly darker
  const strokables = svgEl.querySelectorAll('[stroke]');
  strokables.forEach(el => {
    const strokeVal = el.getAttribute('stroke');
    if(strokeVal && strokeVal !== 'none'){
      el.setAttribute('stroke', color);
    }
  });
}

async function inlineAllMonthSvgs(container){
  const svgCache = [];
  for(let i=0;i<monthFiles.length;i++){
    const path = `assets/months/${monthFiles[i]}`;
    try{
      const text = await fetchText(path);
      svgCache.push(text);
    }catch(err){
      console.warn('Failed to fetch', path, err);
      svgCache.push(null);
    }
  }
  // create wrappers and insert into timeline
  const timeline = document.getElementById('timeline');

  for(let i=0;i<12;i++){
    const left = monthPercentages[i] + '%';

    // wrapper for svg icon (positioned above month label)
    const w = document.createElement('div');
    w.className = 'month-svg-wrapper';
    w.style.left = left;
    w.dataset.monthIndex = i;

    // if svg loaded, inline it
    const raw = svgCache[i];
    if(raw){
      try{
        const svgEl = svgTextToElement(raw);
        // recolor
        recolorSvg(svgEl, monthColors[i]);
        // small default class
        svgEl.classList.add('month-icon');
        // append svg inline
        w.appendChild(svgEl);
      }catch(e){
        console.error('SVG parse error', e);
        // fallback: show an emoji if parse fails
        w.textContent = '✳️';
      }
    }else{
      w.textContent = '◻';
    }

    // insert wrapper into timeline (above everything)
    timeline.appendChild(w);
  }
}

// Add animations / decorative particles for a given month (index)
function addMonthDecorations(monthIndex, activeOnly=false){
  const timeline = document.getElementById('timeline');
  const leftBase = monthPercentages[monthIndex];

  // helper to create particle with randomized offset
  function makeParticle(cls, count=8, color=null, spread=4, top=-48){
    for(let k=0;k<count;k++){
      const p = document.createElement('div');
      p.className = cls;
      if(color) p.style.background = color;
      // random left variation in percent relative to leftBase
      const xOffset = (Math.random()*spread) - (spread/2);
      p.style.left = (leftBase + xOffset) + '%';
      p.style.top = (top) + 'px';
      p.style.opacity = 0;
      p.style.animationDuration = (1.2 + Math.random()*1.8) + 's';
      p.style.animationDelay = (Math.random()*1.0) + 's';
      timeline.appendChild(p);
    }
  }

  // Only create decoration if active month or if not activeOnly flag
  const doIt = !activeOnly || (activeOnly && monthIndex===currentMonthForced);
  // We'll allow adding decorations but keep them ephemeral (they loop but are harmless)

  switch(monthIndex){
    case 0: // Jan - flocons
      makeParticle('janflake', 10, '#cfeeff', 6, -64);
      break;
    case 2: // Mar - petals
      makeParticle('mar-petal', 10, '#ff69b4', 6, -64);
      break;
    case 4: // May - small buds (use float)
      makeParticle('mar-petal', 8, '#9be7a8', 5, -60);
      break;
    case 7: // Aug - waves
      // create a few vertical wave bars near icon
      for(let n=0;n<4;n++){
        const w = document.createElement('div');
        w.className = 'aug-wave';
        const xOffset = (Math.random()*6) - 3;
        w.style.left = (leftBase + xOffset) + '%';
        w.style.top = '-52px';
        w.style.height = (12 + Math.random()*12) + 'px';
        w.style.animationDelay = (Math.random()*0.6) + 's';
        timeline.appendChild(w);
      }
      break;
    case 8: // Sep - leaves (reuse petals brownish)
      makeParticle('mar-petal', 10, '#c88f4f', 6, -64);
      break;
    case 11: // Dec - stars
      makeParticle('dec-star', 14, 'gold', 8, -64);
      break;
    case 9: // Oct - ghost float (pulse)
      // small ghosts could be faked by tiny white circles
      makeParticle('mar-petal', 8, '#f3f4f6', 6, -60);
      break;
    default:
      // nothing default
      break;
  }
}

// We'll allow forcing a month with the select, default to real current month
let currentMonthForced = (new Date()).getMonth();

async function init(){
  await inlineAllMonthSvgs();

  // set progress bar to year progress
  const now = new Date();
  const start = new Date(now.getFullYear(),0,1);
  const end = new Date(now.getFullYear(),11,31);
  const yearProgress = ((now - start) / (end - start)) * 100;
  const fillEl = document.getElementById('progressFill');
  fillEl.style.width = Math.max(0, Math.min(100, yearProgress)) + '%';

  // position envelope above current month
  positionEnvelopeFor(currentMonthForced);

  // add base animations for all icons (soft float)
  document.querySelectorAll('.month-svg-wrapper svg').forEach((svgEl, idx) => {
    // give each a default subtle float
    svgEl.classList.add('float-slow');
    // give special extra animations by month
    const idxMonth = parseInt(svgEl.closest('.month-svg-wrapper').dataset.monthIndex);
    switch(idxMonth){
      case 1: svgEl.classList.add('pulse-soft'); break; // feb heart pulse
      case 6: svgEl.classList.add('pulse-soft'); break; // july sun pulse
      case 7: svgEl.classList.add('spin-slow'); break; // waves spin-ish
      default: break;
    }
  });

  // Add decorations for current (forced) month
  addMonthDecorations(currentMonthForced, true);

  // highlight the icon of the current month
  const wrappers = Array.from(document.querySelectorAll('.month-svg-wrapper'));
  wrappers.forEach(w => w.classList.remove('active'));
  const activeWrapper = document.querySelector(`.month-svg-wrapper[data-month-index="${currentMonthForced}"]`);
  if(activeWrapper) activeWrapper.classList.add('active');
}

// envelope placement: compute position relative to timeline width
function positionEnvelopeFor(monthIndex){
  const timeline = document.getElementById('timeline');
  const envelope = document.getElementById('envelope');
  const left = monthPercentages[monthIndex];
  envelope.style.left = left + '%';
  // ensure envelope visible AFTER left is set
  setTimeout(()=> envelope.classList.add('show'), 60);
}

// Test / UI handlers
document.getElementById('testMonth').addEventListener('change', (e)=>{
  const v = e.target.value;
  if(v===''){ // reset to real month
    currentMonthForced = (new Date()).getMonth();
  } else {
    currentMonthForced = parseInt(v,10);
  }
  // clear old decorations
  document.querySelectorAll('.dec-star, .mar-petal, .janflake, .aug-wave').forEach(n=>n.remove());
  // reposition envelope and re-add decorations
  positionEnvelopeFor(currentMonthForced);
  addMonthDecorations(currentMonthForced, true);
  // update active wrapper
  document.querySelectorAll('.month-svg-wrapper').forEach(w=>w.classList.remove('active'));
  const w = document.querySelector(`.month-svg-wrapper[data-month-index="${currentMonthForced}"]`);
  if(w) w.classList.add('active');
});

document.getElementById('resetTest').addEventListener('click', ()=>{
  document.getElementById('testMonth').value = '';
  currentMonthForced = (new Date()).getMonth();
  // clear decorations
  document.querySelectorAll('.dec-star, .mar-petal, .janflake, .aug-wave').forEach(n=>n.remove());
  positionEnvelopeFor(currentMonthForced);
  addMonthDecorations(currentMonthForced, true);
  document.querySelectorAll('.month-svg-wrapper').forEach(w=>w.classList.remove('active'));
  const w = document.querySelector(`.month-svg-wrapper[data-month-index="${currentMonthForced}"]`);
  if(w) w.classList.add('active');
});

// kick off
init().catch(err => console.error(err));
</script>
</body>
</html>